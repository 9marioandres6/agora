<div class="project-footer">
  <div class="footer-actions">
    <!-- Left side: Following, Support, Reject -->
    <div class="left-actions">
      <ion-button
        [fill]="isUserFollowing(project()) ? 'solid' : 'clear'"
        size="small"
        (click)="onFollowButtonClick($event)"
        class="vote-button"
      >
        <ion-icon name="bookmark"></ion-icon>
        @if ((project().followers || []).length > 0) {
        {{ (project().followers || []).length }}
        }
      </ion-button>

      @if (project().state !== 'done') {
      <ion-button
        [fill]="isUserSupported(project()) ? 'solid' : 'clear'"
        size="small"
        (click)="onSupportButtonClick($event)"
        class="vote-button"
      >
        <ion-icon name="add"></ion-icon>
        @if ((project().supports || []).length > 0) {
        {{ (project().supports || []).length }}
        }
      </ion-button>

      <ion-button
        [fill]="isUserOpposed(project()) ? 'solid' : 'clear'"
        size="small"
        (click)="onOpposeButtonClick($event)"
        class="vote-button"
      >
        <ion-icon name="remove"></ion-icon>
        @if ((project().opposes || []).length > 0) {
        {{ (project().opposes || []).length }}
        }
      </ion-button>
      } @if (project().state === 'done') {
      <ion-button
        [fill]="isUserVerified(project()) ? 'solid' : 'clear'"
        size="small"
        (click)="onVerifyButtonClick($event)"
        class="vote-button"
      >
        {{ "HOME.VERIFY" | translate }}
        @if ((project().verifies || []).length > 0) {
        {{ (project().verifies || []).length }}
        }
      </ion-button>
      }
    </div>

    <!-- Right side: Comments, Collaborators -->
    <div class="right-actions">
      <ion-button
        fill="clear"
        size="small"
        (click)="onCommentsButtonClick($event)"
        class="comments-button"
        [color]="expandedComments() ? 'primary' : ''"
      >
        <ion-icon name="chatbubble-outline"></ion-icon>
        @if ((project().comments || []).length > 0) {
        {{ (project().comments || []).length }}
        }
      </ion-button>
      <ion-button
        fill="clear"
        size="small"
        (click)="onCollaboratorsButtonClick($event)"
        class="collaborators-button"
        [color]="expandedCollaborators() ? 'primary' : ''"
      >
        <ion-icon name="people-outline"></ion-icon>
        @if ((project().collaborators || []).length > 0) {
        {{ (project().collaborators || []).length }}
        }
      </ion-button>
    </div>
  </div>
</div>

<!-- Comments Section -->
@if (expandedComments()) {
<div class="comments-container">
  <!-- Show comment input for all authenticated users -->
  @if (user) {
  <ion-item class="add-comment-section">
    <ion-textarea
      [(ngModel)]="newCommentText"
      [placeholder]="'HOME.COMMENT_PLACEHENTER' | translate"
      rows="2"
      class="comment-textarea"
      (keydown.enter)="onCommentKeydown($event)"
    >
    </ion-textarea>
  </ion-item>
  }

  @if (project().comments && project().comments.length > 0) {
  <div class="comments-list">
    @for (comment of project().comments.slice().reverse(); track comment.id) {
    <div class="comment-item">
      <div class="comment-header">
        <div class="comment-author">
          <strong>{{ comment.creatorName }}</strong>
        </div>
        <div class="comment-date">
          <small>{{ comment.createdAt | date : "short" }}</small>
        </div>
      </div>
      <div class="comment-body">
        <p class="comment-text">{{ comment.text }}</p>
      </div>
    </div>
    }
  </div>
  }
</div>
}

<!-- Collaborators Section -->
@if (expandedCollaborators()) {
<div class="collaborators-container">
  <!-- Creator Section -->
  <div class="creator-section">
    @if (project().creator) {
      <app-user-avatar
        [user]="getCreatorData()"
        [variant]="'creator'"
        [avatarSize]="'small'"
        [showRole]="true"
      >
      </app-user-avatar>
    }
  </div>

  <!-- Current Collaborators -->
  <div class="collaborators-list">
    @if (project().collaborators && project().collaborators.length > 0) { 
      @for (collaborator of project().collaborators; track collaborator.uid) {
      <app-user-avatar
        [user]="getCollaboratorData(collaborator)"
        [variant]="'collaborator'"
        [avatarSize]="'small'"
        [showRole]="true"
        [showJoinedDate]="true"
      >
      </app-user-avatar>
      } 
    } @else {
    <p class="no-data">{{ "HOME.NO_COLLABORATORS" | translate }}</p>
    }
  </div>

  <!-- Request Collaboration Button (for non-creators and non-collaborators) -->
  @if (!isProjectCreator(project()) && !isProjectCollaborator(project()) &&
  !hasCollaborationRequest(project()) && project().state !== 'done') {
  <div class="request-collaboration-section">
    <ion-item>
      <ion-textarea
        [(ngModel)]="collaborationMessage"
        [placeholder]="'HOME.COLLABORATION_MESSAGE_PLACEHOLDER' | translate"
        rows="2"
        class="collaboration-textarea"
      >
      </ion-textarea>
    </ion-item>
    <ion-button
      fill="clear"
      size="small"
      color="primary"
      (click)="submitCollaborationRequest()"
      class="request-collaboration-button"
    >
      {{ "HOME.REQUEST_COLLABORATION" | translate }}
    </ion-button>
  </div>
  }

  <!-- Show pending request status for users who have already requested -->
  @if (!isProjectCreator(project()) && !isProjectCollaborator(project()) &&
  hasCollaborationRequest(project())) {
  <div class="pending-request-section">
    <div class="pending-request-message">
      <ion-icon name="time-outline" class="pending-icon"></ion-icon>
      <span class="pending-text">{{ "HOME.COLLABORATION_REQUEST_PENDING" | translate }}</span>
    </div>
  </div>
  }
</div>
}
